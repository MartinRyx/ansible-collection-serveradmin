#
# Generated by Ansible
#
# Ändringar i denna fil ska göras via Ansible, annars skrivs de över. / Lasse
#

# This is a cron file for rsnapshot.

{% for backupinstance in backup_info.instances.values() %}
{{   backupinstance.name | comment }}
# The values used correspond to the ones used in {{ backupinstance.rsnapshotfile }}
{%   for everyinstance in backupinstance.dest.every | reverse %}
{%     set minute = (backupinstance.dest.start_minute + loop.index0 * backupinstance.dest.minutes_between) % 60 %}
{%     set hour = backupinstance.dest.start_hour + ((backupinstance.dest.start_minute + loop.index0 * backupinstance.dest.minutes_between) // 60) %}
{%     set time = '{%02d}:{%02d}'.format(hour, minute) %}

# {#- ... year/month/week/day/hour... -#}{{- ' ' -}}
{%-     if everyinstance.unit == 'year' -%}
{#-       -#}{{ time }} on 31 dec every year:
{{        minute }} {{ hour }} 31 12 *
{%-     elif everyinstance.unit == 'month' -%}
{#-       -#}{{ time }} the 1st every {{ everyinstance.interval == 1 | ternary('month', everyinstance.interval ~ ' months') }}:
{{        minute }} {{ hour }} 1 */{{ everyinstance.interval }} *
{%-     elif everyinstance.unit == 'week' -%}
{#-       -#}{{ time }} on Monday every week:
{{        minute }} {{ hour }} * * 1
{%-     elif everyinstance.unit == 'day' -%}
{#-       -#}{{ time }} every {{ everyinstance.interval == 1 | ternary('day', everyinstance.interval ~ ' days') }}:
{{        minute }} {{ hour }} */{{ everyinstance.interval }} * *
{%-     elif everyinstance.unit == 'hour' -%}
{#-       -#}{{ minute }} past every {{ everyinstance.interval == 1 | ternary('hour', everyinstance.interval ~ ' hours') }}:
{{        minute }} {{ range(hour % everyinstance.interval, 23, everyinstance.interval)|join(',') }} * * *
{%-     else -%}
{{-       null | mandatory(everyinstance.unit ~ ' is an unknown unit!') -}}
{%-     endif -%}
{{- "\t" -}}{{ backup_info.dest_user.name }}	{{ backupinstance.rsnapshotscript }} {{ everyinstance.name }}

{%   endfor %}
{% endfor %}

#* * * * *
#| | | | |
#| | | | +---- Day of the Week   (range: 1-7, 1 standing for Monday)
#| | | +------ Month of the Year (range: 1-12)
#| | +-------- Day of the Month  (range: 1-31)
#| +---------- Hour              (range: 0-23)
#+------------ Minute            (range: 0-59)