#
# Generated by Ansible
#
# Ändringar i denna fil ska göras via Ansible, annars skrivs de över. / Lasse
#

# This is a cron file for rsnapshot.

{% for backupinstance in backup_info.instances.values() %}
{{   backupinstance.name | comment }}
# The values used correspond to the ones used in {{ backupinstance.rsnapshotfile }}
{%   for everyinstance in backupinstance.dest.every | reverse %}
{%     set minute = (backupinstance.dest.start_minute + loop.index0 * backupinstance.dest.minutes_between) % 60 %}
{%     set hour = backupinstance.dest.start_hour + ((backupinstance.dest.start_minute + loop.index0 * backupinstance.dest.minutes_between) // 60) %}

# Every{#- ... year/month/week/day/hour... -#}{{- ' ' -}}
{%-     if everyinstance.unit == 'year' -%}
{#-       -#}year: (31 dec)
{{        minute }} {{ hour }} 31 12 *
{%-     elif everyinstance.unit == 'month' -%}
{#-       -#}{{ everyinstance.interval }} month(s): (1st)
{{        minute }} {{ hour }} 1 */{{ everyinstance.interval }} *
{%-     elif everyinstance.unit == 'week' -%}
{#-       -#}week: (Monday)
{{        minute }} {{ hour }} * * 1
{%-     elif everyinstance.unit == 'day' -%}
{#-       -#}{{ everyinstance.interval }} day(s):
{{        minute }} {{ hour }} */{{ everyinstance.interval }} * *
{%-     elif everyinstance.unit == 'hour' -%}
{#-       -#}{{ everyinstance.interval }} hour(s):
{{        minute }} {{ range(hour % everyinstance.interval, 23, everyinstance.interval)|join(',') %} * * *
{%-     else -%}
{{-       "Okänd unit!"/0 -}}
{%-     endif -%}
{{- "\t" -}}{{ backup_info.dest_user.name }}	{{ backupinstance.rsnapshotscript }} {{ everyinstance.name }}

{%   endfor %}
{% endfor %}

#* * * * *
#| | | | |
#| | | | +---- Day of the Week   (range: 1-7, 1 standing for Monday)
#| | | +------ Month of the Year (range: 1-12)
#| | +-------- Day of the Month  (range: 1-31)
#| +---------- Hour              (range: 0-23)
#+------------ Minute            (range: 0-59)