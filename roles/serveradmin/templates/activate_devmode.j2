#!/bin/bash



INCLUDE_DEVMODE_PATH="{{ serveradmin.path }}/include_devmode.sh"

if [ -z ${1+x} ]; then

 # Fr√•n: https://stackoverflow.com/questions/1885525/how-do-i-prompt-a-user-for-confirmation-in-bash-script
read -p "Press D to make devmode active, N for normal mode. [d/n]" -n 1 -r
echo    # (optional) move to a new line

else
REPLY="$1"
fi

if [[ $REPLY =~ ^[Dd]$ ]]; then

  (cat <<EOF
#!/bin/bash
# You can delete this file to inactivate devmode
devmode_suffix="-devmode"
EOF
  ) | sudo -u {{ serveradmin.process_user }} tee "$INCLUDE_DEVMODE_PATH" > /dev/null
fi

if [[ $REPLY =~ ^[Nn]$ ]]; then
sudo rm -f "$INCLUDE_DEVMODE_PATH"
fi

devmode_suffix=""

test -f "$INCLUDE_DEVMODE_PATH" && source "$INCLUDE_DEVMODE_PATH"

if [[ $devmode_suffix == "-devmode" ]]; then
	echo "Devmode for serveradmin repo is ACTIVE. You need to pull and push the repo manually."
else
	echo "Normal: Serveradmin will pull latest serveradmin repo on every run."
fi
