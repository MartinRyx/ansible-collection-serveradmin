#
# Generated by Ansible
#
# Ändringar i denna fil ska göras via Ansible, annars skrivs de över. / Lasse
#

{% for name, webinstance in webinstance_facts.items() %}
{{   name | comment }}
{%   if webinstance.enable_php %}
{{ webinstance.path }}/log/php-fpm/*log {
    daily
    rotate 30
    missingok
    notifempty
    sharedscripts
    delaycompress
    postrotate
        /bin/kill -SIGUSR1 `cat /run/php-fpm/php-fpm.pid 2>/dev/null` 2>/dev/null || true
    endscript
}
{%   endif %}

{{ webinstance.path }}/log/nginx/*log {
    create 0644 {{ nginx_user }} {{ nginx_group }}
    daily
    rotate 30
    missingok
    notifempty
    compress
    sharedscripts
    postrotate
        /bin/kill -USR1 `cat /run/nginx.pid 2>/dev/null` 2>/dev/null || true
    endscript
}
{% endfor %}

# TODO: https://mariadb.com/kb/en/library/rotating-logs-on-unix-and-linux/


/var/log/mariadb/* {
        missingok
        create 660 mysql mysql
        notifempty
        daily
		# minsize: only use with logrotate >= 3.7.4
        minsize 1M
		# maxsize: only use with logrotate >= 3.8.1
        maxsize 100M 
        rotate 30
        # dateext # only use if your logrotate version is compatible with below dateformat
        # dateformat .%Y-%m-%d-%H-%M-%S # only use with logrotate >= 3.9.2
        compress
        delaycompress
        sharedscripts 
        # olddir archive/
        # createolddir 770 mysql mysql # only use with logrotate >= 3.8.9
    postrotate
        # just if mysqld is really running
        if test -x /usr/bin/mysqladmin && \
           /usr/bin/mysqladmin ping &>/dev/null
        then
           /usr/bin/mysqladmin --local flush-error-log \
              flush-engine-log flush-general-log flush-slow-log
        fi
    endscript
}
