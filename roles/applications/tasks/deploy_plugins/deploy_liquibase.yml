---
- name: KÃ¶r liquibase  
  shell: >-
    {{ serveradmin.path }}/workspace/serveradmin/tools/liquibase/liquibase
    --driver="org.mariadb.jdbc.Driver"
    --username="{{ serveradmin.process_user }}"
    --url="jdbc:mariadb://localhost/{{ application.database }}?localSocket=/var/lib/mysql/mysql.sock&useUnicode=true&characterEncoding=UTF-8&serverTimezone=Europe/Stockholm"
    --changeLogFile="{{ deploy.change_log_file }}"
    --contexts="{{ application.environment }}"
    {{- ' '+item -}}
  args:
    chdir: "{{ deploy_facts[deploy.repo | mandatory].repo_source }}/{{ deploy.change_log_dir }}"
  loop:
    - "update"
    - "tag {{ deploy_facts[deploy.repo].version }}"
